<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Processing data • tools4watlas</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Processing data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tools4watlas</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_workflows.html">Basic workflow</a></li>
    <li><a class="dropdown-item" href="../articles/load_and_check_data.html">Loading and checking data</a></li>
    <li><a class="dropdown-item" href="../articles/plot_data.html">Plotting data</a></li>
    <li><a class="dropdown-item" href="../articles/process_data.html">Processing data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/allertbijleveld/tools4watlas/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Processing data</h1>
                        <h4 data-toc-skip class="author">Johannes
Krietsch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/allertbijleveld/tools4watlas/blob/master/vignettes/process_data.Rmd" class="external-link"><code>vignettes/process_data.Rmd</code></a></small>
      <div class="d-none name"><code>process_data.Rmd</code></div>
    </div>

    
    
<p>This vignette shows a simple workflow to process WATLAS data and add
tidal data. After loading the data, we calculate the standard deviation
and speed, filter our data based on the variance of the estimated
coordinates and speed and then calculate the speed and turning angles.
Lastly, we merge our data with local water level data.</p>
<div class="section level2">
<h2 id="loading-the-data">Loading the data<a class="anchor" aria-label="anchor" href="#loading-the-data"></a>
</h2>
<p>This procedure is described in detail in the vignette <a href="https://krietsch.github.io/tools4watlas/articles/load_and_check_data.html" class="external-link"><code>Load and check data</code></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://allertbijleveld.github.io/tools4watlas/" class="external-link">tools4watlas</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load meta data</span></span>
<span><span class="va">all_tags_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tags_watlas_subset.xlsx"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"tools4watlas"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">all_tags</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="va">all_tags_path</span>, sheet <span class="op">=</span> <span class="st">"tags_watlas_all"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset desired tags using data.table</span></span>
<span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="va">all_tags</span><span class="op">[</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2023</span><span class="op">]</span><span class="op">$</span><span class="va">tag</span></span>
<span></span>
<span><span class="co"># Time period for which data should be extracted form the database (in CET)</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="st">"2023-10-01 12:00:00"</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="st">"2023-10-02 12:00:00"</span></span>
<span></span>
<span><span class="co"># Database connection</span></span>
<span><span class="va">sqlite_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"watlas_example.SQLite"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"tools4watlas"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sqlite_db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load data from database</span></span>
<span><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">tags</span>,</span>
<span>  <span class="va">atl_get_data</span>,</span>
<span>  tracking_time_start <span class="op">=</span> <span class="va">from</span>,</span>
<span>  tracking_time_end <span class="op">=</span> <span class="va">to</span>,</span>
<span>  timezone <span class="op">=</span> <span class="st">"CET"</span>,</span>
<span>  use_connection <span class="op">=</span> <span class="va">con</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Close connection</span></span>
<span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculate-sd-and-speed">Calculate sd and speed<a class="anchor" aria-label="anchor" href="#calculate-sd-and-speed"></a>
</h2>
<p>With the data of interest, some basic variables can be calculated,
for instance, calculating speeds and turning angles from consecutive
localizations. Speed can then be used for filtering potentially
erroneous localizations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform the lists to data.tables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_split</span>, <span class="va">setDT</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate SD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span><span class="op">[</span>, <span class="va">sd</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">varx</span> <span class="op">+</span> <span class="va">vary</span> <span class="op">+</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">covxy</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate speed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>    speed_in <span class="op">=</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span><span class="va">dt</span>, type <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span>,</span>
<span>    speed_out <span class="op">=</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span><span class="va">dt</span>, type <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Look at the distribution of the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unlist to data.table</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">data_split</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot speed (subset relevant range)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">speed_in</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">speed_in</span> <span class="op">&gt;</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">speed_in</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed_in</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Speed in (m/s)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="process_data_files/figure-html/unnamed-chunk-3-1.png" alt="Distribution of flight speeds" width="100%"><p class="caption">
Distribution of flight speeds
</p>
</div>
</div>
<div class="section level2">
<h2 id="filter-by-the-variance-of-coordinates-and-speed">Filter by the variance of coordinates and speed<a class="anchor" aria-label="anchor" href="#filter-by-the-variance-of-coordinates-and-speed"></a>
</h2>
<p>The next step is to remove localization errors, for instance, by
applying basic filtering on the variances in estimating x- and
y-coordinates and speed. From the above plot we see some unrealistic
speeds, we therefore exclude all data with speeds faster than 35
m/s.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter by speed and variance</span></span>
<span><span class="va">var_max</span> <span class="op">&lt;-</span> <span class="fl">5000</span> <span class="co"># variance in meters squared</span></span>
<span><span class="va">speed_max</span> <span class="op">&lt;-</span> <span class="fl">35</span> <span class="co"># m/s (126 km/h)</span></span>
<span></span>
<span><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data_split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_filter_covariates.html">atl_filter_covariates</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">dt</span>,</span>
<span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"varx &lt; var_max"</span>,</span>
<span>      <span class="st">"vary &lt; var_max"</span>,</span>
<span>      <span class="st">"speed_in &lt; speed_max | is.na(speed_in)"</span>,</span>
<span>      <span class="st">"speed_out &lt; speed_max | is.na(speed_out)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h2>
<p>To further reduce error in the localization data, a basic smoother
such as a median filter can be applied.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Smooth the data</span></span>
<span><span class="va">med_filter</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of localizations within window for smoothing</span></span>
<span></span>
<span><span class="co"># since the function modifies in place, we shall make a copy</span></span>
<span><span class="va">data_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">data_smooth</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">atl_median_smooth</span>,</span>
<span>  moving_window <span class="op">=</span> <span class="va">med_filter</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Peek at the data to see what happend:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Smooth the data</span></span>
<span><span class="va">med_filter</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of localizations within window for smoothing</span></span>
<span></span>
<span><span class="co"># since the function modifies in place, we shall make a copy</span></span>
<span><span class="va">data_smooth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">data_smooth</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">atl_median_smooth</span>,</span>
<span>  moving_window <span class="op">=</span> <span class="va">med_filter</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After smoothing the data, the speeds need to be recalculated. We now
also calculate turning angles. Note: the distance between smoothed
positions can be 0 and therefore will produce NAs and a warning</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select data from first list</span></span>
<span><span class="va">d1_raw</span> <span class="op">&lt;-</span> <span class="va">data_split</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">d1_smooth</span> <span class="op">&lt;-</span> <span class="va">data_smooth</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># subset first day</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">d1_raw</span><span class="op">[</span>, <span class="va">datetime</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">d1_raw</span><span class="op">[</span>, <span class="va">datetime</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span></span>
<span><span class="va">d1_raw</span> <span class="op">&lt;-</span> <span class="va">d1_raw</span><span class="op">[</span><span class="va">datetime</span> <span class="op"><a href="https://rdrr.io/pkg/data.table/man/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">d1_smooth</span> <span class="op">&lt;-</span> <span class="va">d1_smooth</span><span class="op">[</span><span class="va">datetime</span> <span class="op"><a href="https://rdrr.io/pkg/data.table/man/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create basemap</span></span>
<span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_create_bm.html">atl_create_bm</a></span><span class="op">(</span><span class="va">d1_smooth</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">bm</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d1_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"firebrick3"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d1_smooth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d1_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"firebrick3"</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d1_smooth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="process_data_files/figure-html/unnamed-chunk-7-1.png" alt="Smoothed track (black) on top of raw track (red)" width="100%"><p class="caption">
Smoothed track (black) on top of raw track (red)
</p>
</div>
</div>
<div class="section level2">
<h2 id="adding-tidal-data">Adding tidal data<a class="anchor" aria-label="anchor" href="#adding-tidal-data"></a>
</h2>
<p>After following the above basic steps, the data will be ready for
adding environmental data, such as water levels.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># unlist to data.table</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">data_smooth</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">tag</span>, <span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># path to tide data</span></span>
<span><span class="va">tides_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"example_2023_tide_data_UTC.csv"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"tools4watlas"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tide_data_highres_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"extdata"</span>, <span class="st">"example_2023_tide_data_highres_UTC.csv"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"tools4watlas"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load tide data</span></span>
<span><span class="va">tides</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">tides_path</span><span class="op">)</span></span>
<span><span class="va">tide_data_highres</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">tide_data_highres_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add tide data to movement data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_add_tidal_data.html">atl_add_tidal_data</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  tide_data <span class="op">=</span> <span class="va">tides</span>,</span>
<span>  tide_data_highres <span class="op">=</span> <span class="va">tide_data_highres</span>,</span>
<span>  waterdata_resolution <span class="op">=</span> <span class="st">"10 minute"</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show first 5 rows (subset of columns to show additional ones)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">posID</span>, <span class="va">tag</span>, <span class="va">datetime</span>, <span class="va">tideID</span>, <span class="va">tidaltime</span>, <span class="va">time2lowtide</span>, </span>
<span>              <span class="va">waterlevel</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="27%">
<col width="10%">
<col width="13%">
<col width="17%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="right">posID</th>
<th align="left">tag</th>
<th align="left">datetime</th>
<th align="right">tideID</th>
<th align="right">tidaltime</th>
<th align="right">time2lowtide</th>
<th align="right">waterlevel</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:08:42</td>
<td align="right">2023529</td>
<td align="right">18.70</td>
<td align="right">-391.30</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:08:48</td>
<td align="right">2023529</td>
<td align="right">18.80</td>
<td align="right">-391.20</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:08:51</td>
<td align="right">2023529</td>
<td align="right">18.85</td>
<td align="right">-391.15</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:08:54</td>
<td align="right">2023529</td>
<td align="right">18.90</td>
<td align="right">-391.10</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:08:57</td>
<td align="right">2023529</td>
<td align="right">18.95</td>
<td align="right">-391.05</td>
<td align="right">112</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="left">3040</td>
<td align="left">2023-10-01 10:09:03</td>
<td align="right">2023529</td>
<td align="right">19.05</td>
<td align="right">-390.95</td>
<td align="right">112</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="data-selection">Data selection<a class="anchor" aria-label="anchor" href="#data-selection"></a>
</h2>
<p>For specific analyses, the cleaned data can be selected. To select
localizations when mudlfats are available for foraging, we can for
example select a low tide period from -2.5 hours to +2.5 hours around
low tide <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2015.1557" class="external-link">(Bijleveld
et al. 2016)</a>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check tide ID</span></span>
<span><span class="va">data</span><span class="op">[</span>, <span class="va">tideID</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2023529 2023530</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select the low tide period for a particular tide as specified by tideID</span></span>
<span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_filter_covariates.html">atl_filter_covariates</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"tideID == 2023530"</span>,</span>
<span>    <span class="st">"between(time2lowtide, -2.5 * 60, 2.5 * 60)"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Save as example data for <code>tools4watlas</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reassign so data is data</span></span>
<span><span class="va">data_example</span> <span class="op">&lt;-</span> <span class="va">data_subset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">data_example</span>, file <span class="op">=</span> <span class="st">"./data/watlas_data_example.rda"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allert Bijleveld, Pratik Gupte, Christine Beardsworth, Johannes Krietsch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
